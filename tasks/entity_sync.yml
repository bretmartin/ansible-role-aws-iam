---

- name: set IAM entity facts
  set_fact:
    _aws_iam_entity_name: '{{ item }}'
    _aws_iam_e: 'IAM {{ _aws_iam_entity_type }} {{ item }}'
    _aws_iam_eurl: >-
      https://console.aws.amazon.com/iam/home#{{
        _aws_iam_entity_type }}s/{{ item }}

- name: set configuration fact for IAM {{ _aws_iam_entity_type }}s
  set_fact:
    _aws_iam_configured_entities: >
      {{ vars["aws_iam_" + _aws_iam_entity_type + "s"] }}

- include: entity_sync_managed_policies_facts.yml
- include: entity_sync_managed_policies_attach.yml
- include: entity_sync_managed_policies_detach.yml

- include: entity_sync_inline_policies_facts.yml
- include: entity_sync_inline_policies_add.yml
- include: entity_sync_inline_policies_delete.yml
- include: entity_sync_inline_policies_update.yml

- include: entity_sync_user_groups.yml
  when: _aws_iam_entity_type == 'user'

- include: entity_sync_assume_role_policy.yml
  when: _aws_iam_entity_type == 'role'
